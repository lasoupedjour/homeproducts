<div class="container my-3">
  <div class="row">
    <div class="col-12">
      <div class="statusapp">
        <div class="paso active">
          <div class="wrap">
            <span>1</span>
          </div>
          <div>Clientes</div>
        </div>
        <div class="paso active">
          <div class="wrap">
            <span>2</span>
          </div>
          <div>Reporte del Caso</div>
        </div>
        <div class="paso active">
          <div class="wrap">
            <span>3</span>
          </div>
          <div>Reparación</div>
        </div>
        <div class="paso active">
          <div class="wrap">
            <span>4</span>
          </div>
          <div>Orden de Servicio</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Cliente-->
<div class="container">
  <div class="row mt-5">
    <div class="col-12 text-right bold">
      Cliente: <a routerLink="/inicio/cliente/detalle"><span [innerHtml]="this._global.cliente.objeto.RazonSocial"> </span><span [innerHtml]="this._global.cliente.objeto.Nombre"></span>&nbsp;<span [innerHtml]="this._global.cliente.objeto.APaterno"></span>&nbsp;<span [innerHtml]="this._global.cliente.objeto.AMaterno"></span></a>
    </div>
  </div>
</div>

<div class="container" >
  <div class="row mt-5">
    <div class="col-sm-12 naranja">
      <h4><b>Orden de Servicio</b> #{{_global.reporte.idreporte}}</h4>
      <hr />
    </div>
  </div>
</div>

<div class="container">
  <form *ngIf="status.paso == 1" class="formulario formularioOrden my-3" name="formularioorden" [formGroup]="genericForm" (ngSubmit)="submitRegistro()">


    <div class="row sameheight mt-2">

      <div class="col-sm-4">
        <div class="px-4 bright">
          <div class="sform">1. Distribuidor</div>
          <div class="vform">{{this.RazonSocialDistribuidor}}</div>
        </div>
      </div>

      <div class="col-sm-4">
        <div class="px-4 bright">
          <div class="sform">2. Home Products Group No:</div>
          <div class="vform">{{this._global.reporte.objreporte.Distribuidor}}</div>
        </div>
      </div>

      <div class="col-sm-4">
        <div class="px-4">
          <div class="sform">3. Tipo Reclamo:</div>
          <div class="vform">{{this._global.reporte.objreporte.TipoReclamoDiagnostico}} </div>
        </div>
      </div>
    </div><!--row-->
    <!--DATOS GENERALES-->
    <div class="row mt-2">
      <div class="col-sm-12 my-3">
        <h4 class="mt-3 naranja"><b>Datos Generales</b></h4>
        <hr />
      </div>
    </div>

    <div class="row sameheight mt-2">
      <div class="col-sm-4">
        <div class="px-4 bright">
          <div class="sform mb-3">4. Información del Producto</div>
          <div class="vform"><div class="vformleft">Categoría: </div> <div class="vformright">{{this._global.reporte.objreporte.Categoria}} </div></div>
          <div class="vform"><div class="vformleft">Subcategoría: </div> <div class="vformright">{{this._global.reporte.objreporte.Subcategoria}} </div></div>
          <div class="vform"><div class="vformleft">Modelo: </div> <div class="vformright">{{this._global.reporte.objreporte.Modelo}} </div></div>
          <div class="vform"><div class="vformleft">Producto: </div> <div class="vformright">{{this._global.reporte.objreporte.Tipo}} </div></div>
          <div class="vform"><div class="vformleft">No. de serie: </div> <div class="vformright">{{this._global.reporte.objreporte.NoSerie}} </div></div>
          <div class="vform">
            <div class="vformleft">Condición General: </div>
            <div class="vformright">{{this._global.reporte.objreporte.CondicionProductoDiagnostico}} </div>
          </div>
          <div class="vform">
            <div class="vformleft">Número de Factura: </div>
            <div class="vformright">
              <label>
                <input autocomplete="off" type="text" class="form-control form-control-sm" formControlName="NoFactura" placeholder="" maxlength="80" />
                <span class="alert alert-danger" *ngIf="!genericForm.controls.NoFactura.valid && genericForm.controls.NoFactura.touched">
                  Este campo es requerido
                </span>
              </label>
            </div>
          </div>

          <div class="vform">
            <div class="vformleft">Fecha de Factura: </div>
            <div class="vformright">
              <label class="fecha">

                <input class="form-control form-control-sm fecha" placeholder=""
                       formControlName="FechaFactura" ngbDatepicker #d1="ngbDatepicker" [(ngModel)]="modelfechafactura"  [maxDate]="maxDateObj">
                <button class="input-group-addon" (click)="d1.toggle()" type="button">
                  <i class="fa fa-calendar"></i>
                </button>
                <span class="alert alert-danger" *ngIf="!genericForm.controls.FechaFactura.valid && genericForm.controls.FechaFactura.touched">
                  Este campo es requerido
                </span>
              </label>
            </div>
          </div>
          <div class="vform"><div class="vformleft">Uso del Producto: </div> <div class="vformright">{{this._global.reporte.objreporte.Uso}} </div></div>
        </div>
      </div>

      <div class="col-sm-4">
        <div class="px-4 bright">
          <div class="sform mb-3">5. Información del Cliente:</div>
          <div class="vform"><div class="vformleft">Nombre: </div> <div class="vformright">{{this._global.cliente.objeto.RazonSocial}} {{this._global.cliente.objeto.Nombre}} {{this._global.cliente.objeto.AMaterno}} {{this._global.cliente.objeto.APaterno}} </div></div>
          <div class="vform"><div class="vformleft">Dirección: </div> <div class="vformright">{{this._global.cliente.objeto.Direccion}} </div></div>
          <div class="vform"><div class="vformleft">Estado: </div> <div class="vformright">{{this._global.cliente.objeto.IDEstado}} </div></div>
          <div class="vform"><div class="vformleft">Ciudad: </div> <div class="vformright">{{this._global.cliente.objeto.IDLocalidad}} </div></div>
          <div class="vform"><div class="vformleft">Teléfono: </div> <div class="vformright">{{this._global.cliente.objeto.Telefono}} </div></div>
        </div>
      </div>


      <div class="col-sm-4">
        <div class="px-4">
          <div class="sform mb-3">6. Información del Centro de Servicio</div>
          <div class="vform"><div class="vformleft">Ref. Cliente: </div> <div class="vformright">{{this._global.cliente.objeto.id}} </div></div>
          <div class="vform"><div class="vformleft">Nombre Taller: </div> <div class="vformright">{{this._global.user.NombreCentro}}</div></div>
          <div class="vform"><div class="vformleft">Atendió: </div> <div class="vformright">{{this._global.user.nombre}}</div></div>
          <div class="vform"><div class="vformleft">Email: </div> <div class="vformright">{{this._global.user.Email}}</div></div>
          <div class="vform"><div class="vformleft">Teléfono(s): </div> <div class="vformright">{{this._global.user.Telefono1}} <br> {{this._global.user.Telefono2}} <br> {{this._global.user.Telefono3}}</div></div>
        </div>
      </div>
    </div>

    <!--DAÑO DE PRODUCTO-->
    <div class="row mt-2">
      <div class="col-sm-12 my-3">
        <h4 class="mt-3 naranja"><b>Daño del Producto</b></h4>
        <hr />
      </div>
    </div>

    <div class="row sameheight mt-2">
      <div class="col-sm-6">
        <div class="px-4 bright">
          <div class="sform mb-3">7. Información de daño del Producto</div>
          <div class="vform"><div class="vformleft">Fecha reportada por cliente: </div> <div class="vformright">{{_global.reporte.objreporte.FechaRegistroReporte.replace("00:00:00", "") | date : 'dd/MM/yyyy'}}</div></div>
          <div class="vform">
            <div class="vformleft">No. de parte que causó el daño: </div>
            <div class="vformright">
              <label>
                <select class="form-control form-control-sm" formControlName="NoParteCausoDano" >
                  <option value="" hidden="">Seleccionar No. Parte</option>
                  <option value="No requerido">No requerido</option>
                  <option *ngFor="let item of _global.refaccionesproductos; let i = index" value="{{item.NoParte}} - {{item.Nombre}}">{{item.NoParte}} - {{item.Nombre}}</option>

                </select>
                <span class="alert alert-danger" *ngIf="!genericForm.controls.NoParteCausoDano.valid && genericForm.controls.NoParteCausoDano.touched">
                  Este campo es requerido
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="px-4">
          <div class="sform mb-3">8. Información de daño del Producto</div>
          <div class="vform"><div class="vformleft">Descripción de la falla: </div> <div class="vformright">{{_global.reporte.objreporte.ObservacionesCDSDiagnostico}}</div></div>
          <div class="vform" *ngIf="_global.reporte.objreporte.TipoReclamoDiagnostico == 'Cambio'"><div class="vformleft">Motivo de cambio: </div> <div class="vformright">{{_global.reporte.objreporte.MotivoCambioDiagnostico}}</div></div>

          <div class="vform">
            <div class="vformleft">Resolución: </div>
            <div class="vformright">
              <label>
                <textarea autocomplete="off" type="text" class="form-control form-control-sm" formControlName="Resolucion" placeholder="" maxlength="500" rows="5"></textarea>
                <span class="alert alert-danger" *ngIf="!genericForm.controls.Resolucion.valid && genericForm.controls.Resolucion.touched">
                  Este campo es requerido
                </span>
              </label>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!--COSTOS DE REPARACIÓN-->
    <div class="row mt-2">
      <div class="col-sm-12 my-3">
        <h4 class="mt-3 naranja"><b>Costos de Refacciones</b></h4>
        <hr />
      </div>
    </div>

    <!--REFACCIONES -->
    <div class="row mt-2">
      <div class="col-12">
        <div class="sform mb-3">9. Partes utilizadas</div>

        <!--tabla-->
        <div class="row my-5" *ngIf="_global.refacciones[0]">
          <div class="col-12 mb-5">

            <table>
              <tr>
                <th>Cantidad</th>
                <th>Descripción/No. Parte</th>
                <th>Precio Unitario</th>
                <th>Importe</th>

              </tr>

              <tr *ngFor="let item of _global.refacciones; let i = index">

                <td>
                  {{item.Cantidad}}
                </td>
                <td>
                  {{item.NombreRefaccion}} - {{item.NoParte}}
                </td>
                <td>
                  ${{item.CostoUnitario}}
                </td>
                <td>
                  ${{item.CostoTotal}}
                </td>

              </tr>

            </table>

          </div>
        </div>

        <div class="mb-5" *ngIf="!_global.refacciones[0]">No requiere refacciones.</div>

      </div>
      <!--termina REFACCIONES -->

    </div>

    <div class="row">
      <div class="col-sm-4">
        <div class="sform mb-3">10. Tarifa</div>
        <div *ngIf="this._global.reporte.objreporte.TipoRevision=='domicilio'">
          <b>Movilidad</b>
          <div class="vform"><div class="vformleft">Revisión: </div> <div class="vformright">Domicilio del cliente </div></div>
          <div class="vform"><div class="vformleft">Kilometraje: </div> <div class="vformright">{{this.SubtipoServicio}} </div></div>
          <div class="vform"><div class="vformleft">Costo movilización: </div> <div class="vformright">$ {{this._global.reporte.objreporte.MontoMovilizacion}} USD </div></div>
        </div>
        <div>
          <b>Atención técnica</b>
        </div>
        <label>
          <select class="form-control form-control-sm" formControlName="TipoReparacion" (change)="changeTipoReparacion()">
            <option value="" hidden="">Seleccionar tipo de reparación</option>

            <ng-container *ngFor="let item of _global.tarifas; let i = index">
              <option value="{{item.id}}" *ngIf="item.TipoServicio!='Movilización'">{{item.SubtipoServicio}}</option>
            </ng-container>
          </select>
          <span class="alert alert-danger" *ngIf="!genericForm.controls.TipoReparacion.valid && genericForm.controls.TipoReparacion.touched">
            Este campo es requerido
          </span>
        </label>


      </div>

      <div class="offset-sm-4 col-sm-4" *ngIf="_global.user.IDMaster == 0">

        <div class="vform"><div class="vformleft aright">Valor de Refacciones: </div> <div class="vformright"> $<input type="text" class="form-control-static" formControlName="MontoRefacciones" readonly [ngModel]="MontoRefacciones"/>&nbsp;USD</div></div>
        <div class="vform"><div class="vformleft aright">Atención Técnica: </div> <div class="vformright"> $<input type="text" min="0" class="form-control-static" formControlName="MontoReparacion" readonly [ngModel]="this.tiporeparacion.Valor" />&nbsp;USD</div></div>
        <div class="vform"><div class="vformleft aright">Movilización: </div> <div class="vformright"> $<input type="text" min="0" class="form-control-static" formControlName="MontoMovilizacion" readonly="{{this.tiporeparacion.NecesitaAutorizacionRO}}" [ngModel]="this._global.reporte.objreporte.MontoMovilizacion" />&nbsp;USD</div></div>
        <!--<div class="vform"><div class="vformleft aright">Costo Landed: </div> <div class="vformright"> $<span [innerHTML]="calculaValorRepuestos()"></span> USD</div></div>-->

        <div [hidden]="!(this._global.reporte.objreporte.TipoReclamoDiagnostico== 'Cambio')">
          <div class="vform"><div class="vformleft aright">Despiece: </div> <div class="vformright"> $<input type="text" min="0" class="form-control-static" formControlName="MontoDespiece"  [ngModel]="this._global.reporte.objreporte.MontoDespiece" readonly />&nbsp;USD</div>
          </div>
          <div class="vform"><div class="vformleft aright">Reciclaje: </div> <div class="vformright"> $<input type="text" min="0" class="form-control-static" formControlName="MontoReciclaje"  [ngModel]="this._global.reporte.objreporte.MontoReciclaje" (change)="changeMontoReciclaje()" />&nbsp;USD</div>
            <div class="alert alert-danger" *ngIf="!genericForm.controls.MontoReciclaje.valid && genericForm.controls.MontoReciclaje.touched">
              Este campo es requerido
            </div>
          </div>
          <div class="vform"><div class="vformleft aright">Otro Costo: </div> <div class="vformright"> $<input type="text" min="0" class="form-control-static" formControlName="MontoOtro"  [ngModel]="this._global.reporte.objreporte.MontoOtro" (change)="changeMontoOtro()" />&nbsp;USD</div>
            <div class="alert alert-danger" *ngIf="!genericForm.controls.MontoOtro.valid && genericForm.controls.MontoOtro.touched">
              Este campo es requerido
            </div>
          </div>
          <div class="vform"><div class="vformleft aright">Otro Costo (Descripción): </div> <div class="vformright"> &nbsp;&nbsp;<input type="text" class="form-control-static" formControlName="MontoOtroDescripcion" maxlength="250"  [ngModel]="this._global.reporte.objreporte.MontoOtroDescripcion" /></div>
            <div class="alert alert-danger" *ngIf="!genericForm.controls.MontoOtroDescripcion.valid && genericForm.controls.MontoOtroDescripcion.touched">
              Este campo es requerido
            </div>
          </div>
        </div>

        <div class="vform"><div class="vformleft aright">Subtotal: </div> <div class="vformright"> $<input type="text" class="form-control-static" formControlName="MontoSubtotal" readonly [ngModel]="MontoSubtotal" />&nbsp;USD</div></div>
        <div class="vform"><div class="vformleft aright">IVA%: </div> <div class="vformright"> $<input type="text" class="form-control-static" formControlName="MontoIVA" readonly [ngModel]="MontoIVA" />&nbsp;USD</div></div>
        <div class="vform"><div class="vformleft aright">Total: </div> <div class="vformright"> $<input type="text" class="form-control-static" formControlName="MontoTotal" readonly [ngModel]="MontoTotal" />&nbsp;USD</div></div>
      </div>

    </div>


    <!--Archivos adjuntos-->
    <div class="row">
      <div class="col-sm-12 my-3">
        <h4 class="mt-3 naranja"><b>Archivos adjuntos</b></h4>
        <hr />
      </div>
    </div>

    <div class="row">
      <div class="col-sm-4 mb-5">
        <div class="row">
          <div class="col-4 text-right">
            <div class="sform mb-3">11. <i>Factura o ticket de compra</i> del producto:</div>
          </div>
          <div class="col-8">
            <div class="row no-gutters" >
              <div class="col-12 mb-1">
                <ng2-file-input (onAction)="onActionFacturasNotasCompra($event)" ></ng2-file-input>
                <span class="alert alert-danger" *ngIf="this.FacturasNotasCompraLenght==0 && this.adjuntosValidos==false">
                  Este campo es requerido
                </span>
              </div>

            </div>

          </div>
        </div>
      </div>

      <div class="col-sm-4 mb-5">
        <div class="row">
          <div class="col-4 text-right">
            <div class="sform mb-3">12. <i>Fotos del modelo y no. serie</i> de producto:</div>
          </div>
          <div class="col-8">
            <div class="row">
              <div class="col-12 mb-1">
                <ng2-file-input (onAction)="onActionFotosModeloSerie($event)"></ng2-file-input>
                <span class="alert alert-danger" *ngIf="this.FacturasRepuestosLenght==0 && this.adjuntosValidos==false">
                  Este campo es requerido
                </span>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div class="col-sm-4 mb-5">
        <div class="row">
          <div class="col-4 text-right">
            <div class="sform mb-3">13. <i>Facturas de repuestos</i> utilizados:</div>
          </div>
          <div class="col-8">
            <div class="row">
              <div class="col-12 mb-1">
                <ng2-file-input (onAction)="onActionFacturasRepuestos($event)"></ng2-file-input>
                <span class="alert alert-danger" *ngIf="this.FotosModeloSerieLenght==0 && this.adjuntosValidos==false">
                  Este campo es requerido
                </span>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div class="col-sm-4 mb-5">
        <div class="row">
          <div class="col-4 text-right">
            <div class="sform mb-3">13. Adjuntar <i>otro</i>:</div>
          </div>
          <div class="col-8">
            <div class="row">
              <div class="col-12 mb-1">
                <ng2-file-input (onAction)="onActionOtros($event)"></ng2-file-input>
              </div>
            </div>

          </div>
        </div>
      </div>


    </div><!--termina Archivos Adjuntos-->
    <!--HP-->
    <!--div class="row">
      <div class="col-sm-12 my-3 mt-5 grayed">
        <h4 class="mt-3"><b>Resolución (llenado exclusivo de Home Products Group After Sales Dept)</b></h4>
        <hr />
      </div>
    </div>

    <div class="row grayed">
      <div class="col-sm-5">
        <div class="row mb-1">
          <div class="col-4 text-right">
            Procesado por:
          </div>
          <div class="col-8">
            <input type="text" class="form-control form-control-sm" disabled />
          </div>
        </div>
        <div class="row mb-1">
          <div class="col-4 text-right">
            Reclamo:
          </div>
          <div class="col-8">
            <input type="text" class="form-control form-control-sm" disabled />
          </div>
        </div>
        <div class="row mb-1">
          <div class="col-4 text-right">
            Procesado por:
          </div>
          <div class="col-8">
            <input type="text" class="form-control form-control-sm" disabled />
          </div>
        </div>
      </div>
      <div class="col-sm-7">
        <div class="row mb-1">
          <div class="col-4 text-right">
            Información Completa:
          </div>
          <div class="col-8">
            <input type="text" class="form-control form-control-sm" disabled />
          </div>
        </div>
        <div class="row mb-1">
          <div class="col-4 text-right">
            Razón del Rechazo:
          </div>
          <div class="col-8">
            <input type="text" class="form-control form-control-sm" disabled />
          </div>
        </div>
      </div>

    </div-->




    <div class="row my-5">
      <div class="col-6 bold ">
        <a class="btn btn-sm btnicono" routerLink="/registro-de-casos/reparacion/inicio"><i class="fa fa-angle-left"></i> Anterior</a>
      </div>
      <div class="col-6 text-right bold">
        <button *ngIf="this.status.update == false" class="btn btn-sm" type="submit" [disabled]="this._global.appstatus.loading">Generar orden de servicio</button>
        <button *ngIf="this.status.update == true" class="btn btn-sm" type="submit">Actualizar orden de servicio</button>
      </div>
    </div>


  </form>


  <div class="row">
    <div class="col-12 mt-3">
      <h2 class="alert-danger px-2">{{_global.appstatus.mensaje}}</h2>
    </div>
  </div>


</div><!--container principal-->



  <div class="container" *ngIf="status.paso == 2">

    <div class="row">
      <div class="col-12">
        <h3 *ngIf="this.status.update == false"><i class="fa fa-check-circle"></i> Se ha registrado exitosamente una nueva orden de servicio:</h3>
        <h3 *ngIf="this.status.update == true"><i class="fa fa-check-circle"></i> Se ha actualizado exitosamente la orden de servicio:</h3>
      </div>
    </div>

    <div class="row my-5">
      <div class="col-8">
        <div class="row">
          <div class="col-6">
            Tipo:
          </div>
          <div class="col-6">
            {{_global.cliente.objeto.TipoPersona}}
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            Nombre o Razón Social:
          </div>
          <div class="col-6">
            {{_global.cliente.objeto.RazonSocial}} {{_global.cliente.objeto.Nombre}} {{_global.cliente.objeto.APaterno}} {{_global.cliente.objeto.AMaterno}}
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            No. de Cliente:
          </div>
          <div class="col-6">
            {{_global.cliente.objeto.id}}
          </div>
        </div>
        <div class="row">
          <div class="col-6">
            No. de Orden de Servicio:
          </div>
          <div class="col-6">
            {{_global.reporte.idreporte}}
          </div>
        </div>
      </div>
      <div class="col-4">
        <a class="btn btn-sm" routerLink="/cliente/detalle/">Editar cliente</a>
      </div>
    </div>

    <div class="row my-5">
      <div class="col-6 ">
        <a class="btn btn-sm btnicono" (click)="status.paso = 1"><i class="fa fa-angle-left"></i> Anterior</a>
      </div>
      <div class="col-6 text-right">
        <a class="btn btn-sm" routerLink="/inicio">Terminar</a>
      </div>
    </div>



    <div class="row">
      <div class="col-12 my-5 text-center">

      </div>
    </div>

  </div>
